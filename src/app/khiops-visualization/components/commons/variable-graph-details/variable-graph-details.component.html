<div
  id="variable-graph-details-comp"
  fxLayout="column"
  fxFlexFill
  [ngClass]="{ fullscreen: isFullscreen }"
  *ngIf="
    ((distributionDatas$ | async)?.distributionGraphDatas ||
      (distributionDatas$ | async)?.targetDistributionGraphDatas ||
      (distributionDatas$ | async)?.histogramDatas)
  "
>
  <div
    fxLayout="column"
    class="histogram-loading-indicator"
    fxLayoutAlign="center center"
    fxFlexFill
    *ngIf="isLoading"
  >
    <mat-spinner
      diameter="40"
      color="accent"
      mode="indeterminate"
    ></mat-spinner>
    <span>{{ 'GLOBAL.BIG_FILES_LOADING_WARNING' | translate }}</span>
  </div>
  <div
    fxLayout="column"
    fxFlexFill
    *ngIf="
      !isLoading &&
      ((distributionDatas$ | async)?.distributionGraphDatas ||
        (distributionDatas$ | async)?.targetDistributionGraphDatas ||
        (distributionDatas$ | async)?.histogramDatas)
    "
  >
    <kl-graph-header
      [selectedVariable]="selectedVariable"
      (scaleValueChanged)="onScaleValueChanged($event)"
      (toggleFullscreen)="onToggleFullscreen($event)"
      [hideScale]="hideScaleElt()"
      [showZoom]="(distributionDatas$ | async)?.histogramDatas ? true : false"
    >
    </kl-graph-header>
    <kl-distribution-graph
      #distributionGraph
      fxFlex="1 1 100%"
      *ngIf="
        showDistributionGraph &&
        (distributionDatas$ | async)?.distributionGraphDatas &&
        !(distributionDatas$ | async)?.histogramDatas
      "
      class="distribution-graph"
      id="{{ 'distribution-graph' + position }}"
      [attr.id]="'distribution-graph' + position"
      [position]="position"
      [scrollPosition]="scrollPosition"
      (scrollPositionChanged)="onScrollPositionChanged($event)"
      [scaleValue]="scaleValue"
      [graphOptions]="(distributionDatas$ | async)?.distributionGraphOptionsY"
      [inputDatas]="(distributionDatas$ | async)?.distributionGraphDatas"
      (graphTypeChanged)="onDistributionGraphTypeChanged($event)"
      [activeEntries]="activeEntries"
      (selectedItemChanged)="onSelectedDistributionGraphItemChanged($event)"
    >
    </kl-distribution-graph>

    <app-histogram
      id="app-histogram"
      class="app-histogram"
      *ngIf="(distributionDatas$ | async)?.histogramDatas"
      fxFlex="1 1 100%"
      [graphOptionsX]="(distributionDatas$ | async)?.distributionGraphOptionsX"
      [graphOptionsY]="(distributionDatas$ | async)?.distributionGraphOptionsY"
      [datas]="(distributionDatas$ | async)?.histogramDatas"
      [selectedItem]="activeEntries"
      (selectedItemChanged)="onSelectedDistributionGraphItemChanged($event)"
      [interpretableHistogramNumber]="
        (distributionDatas$ | async)?.interpretableHistogramNumber
      "
      [defaultInterpretableHistogramNumber]="
        (distributionDatas$ | async)?.defaultInterpretableHistogramNumber - 1
      "
      [histogramNumber]="(distributionDatas$ | async)?.histogramNumber"
      (interpretableHistogramChanged)="onInterpretableHistogramChanged($event)"
    >
    </app-histogram>
    <app-target-distribution-graph
      #targetDistributionGraph
      fxFlex="1 1 100%"
      titleTooltip="{{
        'TOOLTIPS.PREPARATION.TARGET_DISTRIBUTION.TITLE' | translate
      }}"
      [position]="position"
      *ngIf="
        showTargetDistributionGraph &&
        (distributionDatas$ | async)?.targetDistributionGraphDatas
      "
      class="target-distribution-graph"
      id="{{ 'target-distribution-graph' + position }}"
      [attr.id]="'target-distribution-graph' + position"
      [displayedValues]="(distributionDatas$ | async)?.targetDistributionDisplayedValues"
      (scrollPositionChanged)="onScrollPositionChanged($event)"
      [scrollPosition]="scrollPosition"
      (selectedItemChanged)="
        onSelectedTargetDistributionGraphItemChanged($event)
      "
      [inputDatas]="(distributionDatas$ | async)?.targetDistributionGraphDatas"
      (graphTypeChanged)="onTargetDistributionGraphTypeChanged($event)"
      [scaleValue]="scaleValue"
      (targetDistributionGraphDisplayedValuesChanged)="
        onTargetDistributionGraphDisplayedValuesChanged($event)
      "
      [activeEntries]="activeEntries"
    ></app-target-distribution-graph>
  </div>
  <kl-no-data
    fxFlexFill
    *ngIf="
      !(distributionDatas$ | async)?.distributionGraphDatas &&
      !(distributionDatas$ | async)?.targetDistributionGraphDatas &&
      !(distributionDatas$ | async)?.histogramDatas
    "
  >
  </kl-no-data>
</div>
