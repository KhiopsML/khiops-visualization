<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>visualization-component documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">visualization-component documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Classes</li>
  <li >Transition</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/khiops-hypertree/components/hypertree/hypertree.ts</code>
        </p>






            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#beginTime" >beginTime</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#currentframe" >currentframe</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#endTime" >endTime</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#frames" >frames</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#hypertree" >hypertree</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#lowdetail" >lowdetail</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#type" >type</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#begin" >begin</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#end" >end</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(hypertree)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="766" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:766</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>hypertree</td>
                                                  
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="beginTime"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>beginTime</b></span>
                        <a href="#beginTime"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="765" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:765</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="currentframe"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>currentframe</b></span>
                        <a href="#currentframe"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Frame.html" target="_self" >Frame</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="764" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:764</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="endTime"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>endTime</b></span>
                        <a href="#endTime"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="766" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:766</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="frames"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>frames</b></span>
                        <a href="#frames"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Frame.html" target="_self" >Frame[]</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="762" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:762</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hypertree"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>hypertree</b></span>
                        <a href="#hypertree"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Hypertree.html" target="_self" >Hypertree</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="760" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:760</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="lowdetail"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>lowdetail</b></span>
                        <a href="#lowdetail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>true</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="763" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:763</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="type"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>type</b></span>
                        <a href="#type"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>&quot;animation&quot; | &quot;interaction&quot; | &quot;script&quot;</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="761" class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:761</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="begin"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>begin</b></span>
                        <a href="#begin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>begin()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="772"
                            class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:772</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="end"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>end</b></span>
                        <a href="#end"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>end()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="777"
                            class="link-to-prism">src/app/khiops-hypertree/components/hypertree/hypertree.ts:777</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import * as d3 from &#x27;d3&#x27;
import {
    HTML
} from &#x27;../../ducd/&#x27;
import {
    clone,
    stringhash
} from &#x27;../../ducd/&#x27;
import {
    HypertreeArgs
} from &#x27;../../models/hypertree/model&#x27;
import {
    N
} from &#x27;../../models/n/n&#x27;
import {
    Path
} from &#x27;../../models/path/path&#x27;
import {
    setZ
} from &#x27;../../models/n/n-layouts&#x27;
import {
    dfsFlat,
    Ï€ify
} from &#x27;../../models/transformation/hyperbolic-math&#x27;
import {
    C
} from &#x27;../../models/transformation/hyperbolic-math&#x27;
import {
    CassignC
} from &#x27;../../models/transformation/hyperbolic-math&#x27;
import {
    CaddC,
    CsubC,
    CmulR
} from &#x27;../../models/transformation/hyperbolic-math&#x27;
import {
    sigmoid
} from &#x27;../../models/transformation/hyperbolic-math&#x27;
import {
    IUnitDisk
} from &#x27;../unitdisk/unitdisk&#x27;
import {
    presets
} from &#x27;../../models/hypertree/preset-base&#x27;
import {
    mergeDeep
} from &#x27;../../ducd/&#x27;
import { doLabelStuff }             from &#x27;../../models/hypertree/preset-process&#x27;

let globelhtid &#x3D; 0

const Ï€ &#x3D; Math.PI
const htmlpreloader &#x3D; &#x60;
    &lt;div class&#x3D;&quot;spinner&quot;&gt;
        &lt;div class&#x3D;&quot;double-bounce1&quot;&gt;&lt;/div&gt;
        &lt;div class&#x3D;&quot;double-bounce2&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;&#x60;

const grad &#x3D; [255, 96, 36, 0]
const bubbleSvgDef &#x3D;
    &#x60;&lt;defs&gt;
        &lt;radialGradient id&#x3D;&quot;exampleGradient&quot;&gt;            
            &lt;stop offset&#x3D;&quot;58%&quot;  stop-color&#x3D;&quot;rgb(${grad[0]},${grad[0]},${grad[0]})&quot; stop-opacity&#x3D;&quot;.15&quot;/&gt;            
            &lt;stop offset&#x3D;&quot;92%&quot;  stop-color&#x3D;&quot;rgb(${grad[1]},${grad[1]},${grad[1]})&quot; stop-opacity&#x3D;&quot;.15&quot;/&gt;
            &lt;stop offset&#x3D;&quot;98%&quot;  stop-color&#x3D;&quot;rgb(${grad[2]},${grad[2]},${grad[2]})&quot; stop-opacity&#x3D;&quot;.15&quot;/&gt;
            &lt;stop offset&#x3D;&quot;100%&quot; stop-color&#x3D;&quot;rgb(${grad[3]},${grad[3]},${grad[3]})&quot; stop-opacity&#x3D;&quot;.15&quot;/&gt;
        &lt;/radialGradient&gt;
    &lt;/defs&gt;&#x60;

const hypertreehtml &#x3D;
    &#x60;&lt;div class&#x3D;&quot;unitdisk-nav&quot;&gt;        
        &lt;svg width&#x3D;&quot;100%&quot; height&#x3D;&quot;100%&quot; preserveAspectRatio&#x3D;&quot;xMidYMid meet&quot; viewBox&#x3D;&quot;-0 0 1000 1000&quot;&gt;
            ${bubbleSvgDef}
        &lt;/svg&gt;
        &lt;div class&#x3D;&quot;preloader&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;&#x60;

export class Hypertree {
    args: HypertreeArgs
    data: N
    langMap: {}

    view_: {
        parent: HTMLElement,
        html ? : HTMLElement,
        //unitdisk?      : IUnitDisk,        
    }

    unitdisk: IUnitDisk
    transition: Transition
    log &#x3D; []

    modelMeta
    langMeta
    layoutMeta

    initPromise: Promise &lt; void &gt;
        initPromisHandler: {
            resolve,
            reject
        }
    isInitializing &#x3D; false

    lastCenterNode &#x3D; undefined

    constructor(view: {
        parent: HTMLElement
    }, args: HypertreeArgs) {
        // console.group(&quot;hypertree constructor&quot;)
        this.view_ &#x3D; view
        this.initPromise &#x3D; this.api.setModel(args)
        // console.groupEnd()
    }

    /*
     * this functions modyfy model/view (this class internal state)
     * and call the according update function(s)
     */
    public api &#x3D; {
        setModel: (model: HypertreeArgs) &#x3D;&gt; new Promise &lt; void &gt; ((ok, err) &#x3D;&gt; {
            //model &#x3D; mergeDeep_(presets[model.baseCfg], model)
            this.isInitializing &#x3D; true
            const base &#x3D; presets.modelBase()
            // console.group(&quot;set model: merging &quot;, model, &#x27; into &#x27;, base)

            //this.args &#x3D; mergeDeep(model, base)
            this.args &#x3D; mergeDeep(base, model)
            // console.log(&#x27;merge result: &#x27;, this.args)

            // wenn parent updatedated hat wraum ist da nich eine alte transformations in der disk            
            this.update.view.parent()
            this.api.setDataloader(ok, err, this.args.dataloader) // resetData is hier drin ðŸ¤” 
            this.api.setLangloader(ok, err, this.args.langloader)
            // console.groupEnd()
        }),
        updateNodesVisualization: () &#x3D;&gt; new Promise &lt; void &gt; ((ok, err) &#x3D;&gt; {
            const previousPosition &#x3D; JSON.parse(JSON.stringify(this.args.geometry.transformation.state.P))
            // this.updateLabelLen_();
            this.updateWeights_()
            this.update.transformation()

            // this.updateLabelsVisibility()
            // doLabelStuff();
            // this.unitdisk.args.cacheUpdate(this.unitdisk, this.unitdisk.cache)
            // this.unitdisk.update.pathes()
            // this.view.layerstack.layers[&#x27;labels-force&#x27;].update.force()   
            // this.unitdisk.update.layout()
            // this.unitdisk.update.cache()
            // this.unitdisk.update.data()
            // this.unitdisk.update.pathes()
            // this.unitdisk.update.transformation()
            // this.updateLang_()
            // this.updateUnitdiskView()

            // Go to previous state without animation
            this.animateTo(ok, err, previousPosition, null)
        }),
        updateNodesDatas: (model: HypertreeArgs) &#x3D;&gt; new Promise&lt;void&gt;((ok, err) &#x3D;&gt; {
            const previousPosition &#x3D; JSON.parse(JSON.stringify(this.args.geometry.transformation.state.P))

            this.isInitializing &#x3D; false
            const base &#x3D; presets.modelBase()
            this.args &#x3D; mergeDeep(base, model)

            // wenn parent updatedated hat wraum ist da nich eine alte transformations in der disk            
            // this.update.view.parent()
            this.updateUnitdiskView()
            this.api.updateDataloader(ok, err, this.args.dataloader) // resetData is hier drin ðŸ¤” 
            // this.update.data();
            // this.api.setLangloader(ok, err, this.args.langloader)
            this.animateTo(ok, err, previousPosition, null, 0)
            // this.animateTo(ok, err, n.layout.z, null, 0)

        }),
        setLangloader: (ok, err, ll) &#x3D;&gt; {
            // console.group(&quot;langloader initiate&quot;)
            this.args.langloader &#x3D; ll

            this.args.langloader((langMap, t1, dl) &#x3D;&gt; {
                // console.group(&quot;langloader&quot;, langMap &amp;&amp; Object.keys(langMap).length || 0)
                this.langMap &#x3D; langMap || {}
                this.updateLang_(dl)
                //requestAnimationFrame(()&#x3D;&gt; this.update.data())
                this.update.data()
                // console.groupEnd()

                if (this.data) {
                    this.isInitializing &#x3D; false;
                    ok()
                }
            })
            // console.groupEnd()
        },
        setDataloader: (ok, err, dl) &#x3D;&gt; {
            // console.group(&quot;dataloader initiate&quot;)
            this.args.dataloader &#x3D; dl
            const t0 &#x3D; performance.now()
            this.resetData()

            this.args.dataloader((d3h, t1, dl) &#x3D;&gt; {
                // console.group(&quot;dataloader&quot;)
                this.initData(d3h, t0, t1, dl)
                // console.groupEnd()

                if (this.langMap) {
                    this.isInitializing &#x3D; false;
                    ok()
                }
            })
            // console.groupEnd()
        },
        updateDataloader: (ok, err, dl) &#x3D;&gt; {
            // console.group(&quot;dataloader initiate&quot;)
            this.args.dataloader &#x3D; dl
            const t0 &#x3D; performance.now()
            this.resetData()

            this.args.dataloader((d3h, t1, dl) &#x3D;&gt; {
                // console.group(&quot;dataloader&quot;)
                this.initData(d3h, t0, t1, dl)
                // console.groupEnd()

                if (this.langMap) {
                    this.isInitializing &#x3D; false;
                    ok()
                }
            })
            // console.groupEnd()
        },
        toggleSelection: (n: N) &#x3D;&gt; {
            this.toggleSelection(n)
            if (this.args.objects.pathes.length &gt; 10 + 1) {
                const toremove &#x3D; this.args.objects.selections[0]
                this.args.objects.selections &#x3D; this.args.objects.selections.filter(e &#x3D;&gt; e !&#x3D;&#x3D; toremove)
                this.removePath(&#x27;SelectionPath&#x27;, toremove)
            }
            this.update.pathes()
        },
        addPath: (pathid, node: N, color) &#x3D;&gt; {
            // // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 151 ~ pathid, node: N, color&quot;, color)
            this.addPath(pathid, node, color)
        },
        removePath: (pathid, node: N) &#x3D;&gt; {
            this.removePath(pathid, node)
        },
        setPathHead: (pathType: Path, n: N) &#x3D;&gt; {
            if (!this.isInitializing &amp;&amp; !this.isAnimationRunning()) {
                this.setPathHead(pathType, n)
                this.update.pathes()
            }
        },
        selectQuery: (query: string, prop: string) &#x3D;&gt; {
            const lq &#x3D; query ? query.toLowerCase() : null
            this.data.each(n &#x3D;&gt; {
                n.pathes.partof &#x3D; []
                n.pathes.headof &#x3D; undefined
                n.pathes.labelcolor &#x3D; undefined
                n.pathes.finalcolor &#x3D; undefined
                n.pathes.isPartOfAnyQuery &#x3D; false
            })
            // console.log(&#x27;QUERY:&#x27;, lq)
            this.args.objects.pathes &#x3D; []
            this.data.each(n &#x3D;&gt; {
                if (n.data) {
                    if (n.data.name.toLowerCase().includes(lq))
                        this.addPath(&#x27;Query&#x27;, n)
                    if (n.precalc &amp;&amp; n.precalc.label)
                        if (n.precalc.label.toLowerCase().includes(lq))
                            this.addPath(&#x27;Query&#x27;, n)
                }
            })
            this.update.pathes()
        },
        gotoHome: (duration: number) &#x3D;&gt; new Promise((ok, err) &#x3D;&gt; this.animateTo(ok, err, {
            re: 0,
            im: 0
        }, null, duration)),
        gotoNode: (n: N, duration: number) &#x3D;&gt; new Promise((ok, err) &#x3D;&gt; this.animateTo(ok, err, CmulR({
            re: n.layout.z.re,
            im: n.layout.z.im
        }, -1), null, duration)),
        goto: (p, l) &#x3D;&gt; new Promise((ok, err) &#x3D;&gt; this.animateTo(ok, err, p, l)),
        gotoÎ»: (l) &#x3D;&gt; new Promise((ok, err) &#x3D;&gt; this.animateToÎ»(ok, err, l))
    }

    /*
     * this functions assume the model/view (this class internal state)
     * has changes, and call the according ui updates (animatin frames)
     */
    public update &#x3D; {
        view: {
            parent: () &#x3D;&gt; {
                // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 252 ~ Hypertree ~ parent&quot;)
                this.updateParent()
            },
            unitdisk: () &#x3D;&gt; {
                // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 255 ~ Hypertree ~ unitdisk&quot;)
                this.updateUnitdiskView()
            },
        },
        data: () &#x3D;&gt; {
            // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 250 ~ Hypertree ~ update data&quot;)
            this.unitdisk.update.data()
        },
        transformation: () &#x3D;&gt; this.unitdisk.update.transformation(),
        pathes: () &#x3D;&gt; this.unitdisk.update.pathes(),
        centernode: (centerNode) &#x3D;&gt; {
            if (this.lastCenterNode &amp;&amp; this.lastCenterNode.mergeId &#x3D;&#x3D; centerNode.mergeId)
                return

            this.lastCenterNode &#x3D; centerNode
            const pathStr &#x3D; centerNode
                .ancestors()
                .reduce((a, e) &#x3D;&gt; &#x60;${e.precalc.label?(&quot;  &quot;+e.precalc.label+&quot;  &quot;):&#x27;&#x27;}${a?&quot;â€º&quot;:&quot;&quot;}${a}&#x60;, &#x27;&#x27;)

            //this.view_.path.innerText &#x3D; pathStr // todo: html m frame?
            if (this.args.interaction.onCenterNodeChange)
                this.args.interaction.onCenterNodeChange(centerNode, pathStr)
        }
    }

    //########################################################################################################
    //##
    //## View Updates
    //##
    //########################################################################################################

    protected updateParent() {
        console.log(&quot;_updateParent&quot;)
        this.view_.parent.innerHTML &#x3D; &#x27;&#x27; // actually just remove this.view if present ... do less
        this.view_.html &#x3D; HTML.parse &lt; HTMLElement &gt; (hypertreehtml)()
        this.view_.parent.appendChild(this.view_.html)

        this.updateUnitdiskView()
    }

    protected updateUnitdiskView() {
        // console.log(&quot;_updateUnitdiskView&quot;)
        var udparent &#x3D; this.view_.html.querySelector(&#x27;.unitdisk-nav &gt; svg&#x27;)
        udparent.innerHTML &#x3D; bubbleSvgDef
        this.unitdisk &#x3D; new this.args.geometry.decorator({
            parent: udparent,
            className: &#x27;unitDisc&#x27;,
            position: &#x27;translate(500,500) scale(480)&#x27;,
            hypertree: this,
        }, {
            data: null, //this.data,
            decorator: null,
            transformation: this.args.geometry.transformation,
            transform: (n: N) &#x3D;&gt; this.unitdisk.args.transformation.transformPoint(n.layout.z),
            layers: this.args.geometry.layers,
            layerOptions: this.args.geometry.layerOptions,
            cacheUpdate: this.args.geometry.cacheUpdate,
            clipRadius: this.args.geometry.clipRadius,
            nodeRadius: this.args.geometry.nodeRadius,
            nodeScale: this.args.geometry.nodeScale,
            nodeFilter: this.args.geometry.nodeFilter,
            linkWidth: this.args.geometry.linkWidth,
            linkCurvature: this.args.geometry.linkCurvature,
            offsetEmoji: this.args.geometry.offsetLabels,
            offsetLabels: this.args.geometry.offsetLabels,
            captionBackground: this.args.geometry.captionBackground,
            captionFont: this.args.geometry.captionFont,
            captionHeight: this.args.geometry.captionHeight,
        })
    }

    //########################################################################################################
    //##
    //## Sync blocks for async api functions
    //##
    //########################################################################################################

    protected resetData() {
        // // console.log(&quot;_resetData&quot;)
        this.view_.html.querySelector(&#x27;.preloader&#x27;).innerHTML &#x3D; htmlpreloader
        this.unitdisk.args.data &#x3D; undefined
        this.data &#x3D; undefined
        this.langMap &#x3D; undefined

        this.args.geometry.transformation.state.Î» &#x3D; .001
        this.args.geometry.transformation.state.P.re &#x3D; 0
        this.args.geometry.transformation.state.P.im &#x3D; 0
        this.args.filter.weightFilter.magic &#x3D; 20
        this.args.geometry.transformation.cache.centerNode &#x3D; undefined
        //this.args.geometry.transformation.cache.hoverNode &#x3D; undefined

        this.args.objects.selections &#x3D; []
        this.args.objects.pathes &#x3D; []
        this.args.objects.traces &#x3D; []

        requestAnimationFrame(() &#x3D;&gt; this.update.data())
    }

    protected initData(d3h, t0, t1, dl) {
        console.log(&quot;_initData&quot;)
        var t2 &#x3D; performance.now()
        var ncount &#x3D; 1
        globelhtid++
        this.data &#x3D; &lt; N &amp; d3.HierarchyNode &lt; N &gt;&gt; d3
            .hierarchy(d3h)
            .each((n: any) &#x3D;&gt; {
                n.globelhtid &#x3D; globelhtid
                n.mergeId &#x3D; ncount++
                n.data &#x3D; n.data || {}
                n.precalc &#x3D; {}
                n.pathes &#x3D; {}
                n.layout &#x3D; null
                n.layoutReference &#x3D; null
            })
        this.unitdisk.args.data &#x3D; this.data
        this.args.geometry.transformation.cache.N &#x3D; this.data.descendants().length

        // layout initiialisation
        const startAngle &#x3D; this.args.layout.rootWedge.orientation
        const defAngleWidth &#x3D; this.args.layout.rootWedge.angle
        this.data.layout &#x3D; {
            wedge: {
                Î±: Ï€ify(startAngle - defAngleWidth / 2),
                Î©: Ï€ify(startAngle + defAngleWidth / 2)
            }
        }
        setZ(this.data, {
            re: 0,
            im: 0
        })

        // PRECALC:
        var t3 &#x3D; performance.now()
        this.updateWeights_()

        // cells kÃ¶nnen true initialisert werden        
        this.data.each(n &#x3D;&gt; n.precalc.clickable &#x3D; true)
        // dataInitBFS:
        // - emoji*
        // - img*
        this.data.each(n &#x3D;&gt; this.args.dataInitBFS(this, n))
        this.modelMeta &#x3D; {
            Î”: [t1 - t0, t2 - t1, t3 - t2, performance.now() - t3],
            filesize: dl,
            nodecount: ncount - 1
        }
        // von rest trennen, da lang alleine benÃ¶tigt wird
        // langInitBFS:
        // - lang
        // - wiki*
        // - labelslen automatisch
        // - clickable&#x3D;selectable*
        // - cell* default &#x3D; clickable? oder true?
        this.updateLang_()

        // hmm, wird niergens mitgemessen :(
        this.findInitÎ»_()

        this.view_.html.querySelector(&#x27;.preloader&#x27;).innerHTML &#x3D; &#x27;&#x27;
    }

    protected updateWeights_(): void {
        // console.log(&quot;_updateWeights&quot;)        
        // sum dinger
        this.sum(this.data, this.args.layout.weight, &#x27;layoutWeight&#x27;)
        this.sum(this.data, this.args.filter.weightFilter.weight, &#x27;cullingWeight&#x27;)
        this.sum(this.data, this.args.layout.weight, &#x27;visWeight&#x27;)
        //this.sum(this.data, this.args.geometry.weight[0], (n, s)&#x3D;&gt; n.visprop[0] &#x3D; s)

        // node dinger
        // for arc width and node radius in some cases, not flexible enough
        this.data.each(n &#x3D;&gt; n.precalc.weightScale &#x3D; (Math.log2(n.precalc.visWeight) || 1) /
            (Math.log2(this.data.precalc.visWeight || this.data.children.length) || 1))
    }

    private sum(data, value, target) {
        data.eachAfter(node &#x3D;&gt; {
            let sum &#x3D; +value(node) || 0
            const children &#x3D; node.children
            var i &#x3D; children &amp;&amp; children.length
            while (--i &gt;&#x3D; 0) sum +&#x3D; children[i].precalc[target]
            node.precalc[target] &#x3D; sum
        })
    }

    protected updateLang_(dl &#x3D; 0): void {
        // console.log(&quot;_updateLang&quot;)
        const t0 &#x3D; performance.now()

        if (this.data) {
            this.data.each(n &#x3D;&gt; this.args.langInitBFS(this, n))
            this.updateLabelLen_()
        }

        if (dl || !this.langMeta) this.langMeta &#x3D; {
            Î”: [performance.now() - t0],
            map: this.langMap,
            filesize: dl
        }
    }

    protected findInitÎ»_(): void {
        // console.groupCollapsed(&#x27;_findInitÎ»&#x27;)

        for (let i &#x3D; 0; i &lt; 50; i++) {
            const progress01 &#x3D; i / 50
            const Î» &#x3D; .02 + sigmoid(progress01) * .75
            //console.log(&#x27;#&#x27;+progress01, Î»)
            this.args.geometry.transformation.state.Î» &#x3D; Î»
            this.updateLayoutPath_(this.data)
            this.unitdisk.args.cacheUpdate(this.unitdisk, this.unitdisk.cache)
            const unculledNodes &#x3D; this.args.geometry.transformation.cache.unculledNodes
            const maxR &#x3D; unculledNodes.reduce((max, n) &#x3D;&gt; Math.max(max, n.layout.zp.r), 0)

            if (maxR &gt; (this.args.layout.initSize || .95)) {
                // console.info(&#x27;MaxR at abort&#x27;, maxR)
                break
            }
        }
        this.data.each((n: N) &#x3D;&gt; n.layoutReference &#x3D; clone(n.layout))

        // console.groupEnd()
        // console.info(&#x27;auto Î» &#x3D; &#x27;, this.args.geometry.transformation.state.Î»)
    }

    //########################################################################################################
    //##
    //## internal functions, calles by ...?
    //##
    //########################################################################################################

    private virtualCanvas &#x3D; undefined
    private virtualCanvasContext &#x3D; undefined
    protected updateLabelLen_(): void {
        // console.log(&quot;_updateLabelLen&quot;)
        var canvas &#x3D; this.virtualCanvas ||
            (this.virtualCanvas &#x3D; document.createElement(&quot;canvas&quot;))
        var context &#x3D; this.virtualCanvasContext ||
            (this.virtualCanvasContext &#x3D; canvas.getContext(&quot;2d&quot;))
        context.font &#x3D; this.args.geometry.captionFont
        //context.textBaseLine &#x3D; &#x27;middle&#x27;
        //context.textAlign &#x3D; &#x27;center&#x27; 

        const updateLabelLen_ &#x3D; (txtprop, lenprop) &#x3D;&gt; {
            this.data.each(n &#x3D;&gt; {
                if (n.precalc[txtprop]) {
                    const metrics &#x3D; context.measureText(n.precalc[txtprop])
                    n.precalc[lenprop] &#x3D; metrics.width / 200 / window.devicePixelRatio
                    // console.assert(typeof n.precalc[lenprop] &#x3D;&#x3D;&#x3D; &#x27;number&#x27;)
                } else
                    n.precalc[lenprop] &#x3D; undefined
            })
        }
        updateLabelLen_(&#x27;label&#x27;, &#x27;labels-forcelen&#x27;)
        updateLabelLen_(&#x27;label&#x27;, &#x27;labelslen&#x27;)
        updateLabelLen_(&#x27;label2&#x27;, &#x27;labels2len&#x27;)
        updateLabelLen_(&#x27;icon&#x27;, &#x27;emojislen&#x27;)
    }

    public updateLayoutPath_(preservingnode: N): void {
        const t &#x3D; this.args.geometry.transformation
        //// console.log(&quot;_updateLayoutPath_&quot;, t.state.Î»)        
        // console.assert(preservingnode)
        const t0 &#x3D; performance.now()

        preservingnode.ancestors().reverse().forEach(n &#x3D;&gt; this.args.layout.type(n, t.state.Î», true))
        t.state.P &#x3D; CmulR(preservingnode.layout.z, -1) // set preserving node back to .... zero? no, orig pos?

        this.layoutMeta &#x3D; {
            Î”: performance.now() - t0
        }
    }

    //########################################################################################################
    //##
    //## Path
    //##
    //########################################################################################################

    protected btnPathId &#x3D; (pathType: string, n: N) &#x3D;&gt; &#x60;btn-path-${pathType}&#x60; + (pathType &#x3D;&#x3D;&#x3D; &#x27;SelectionPath&#x27; ? &#x60;-${n.mergeId}&#x60; : &#x27;&#x27;)
    protected addIfNotInSafe &lt; ArrET &gt; (arr: ArrET[], newE: ArrET, side &#x3D; &#x27;unshift&#x27;): ArrET[] {
        if (!arr) return [newE]
        if (!arr.includes(newE)) arr[side](newE)
        return arr
    }

    protected toggleSelection(n: N) {
        if (this.args.objects.selections.includes(n)) {
            //const nidx &#x3D; this.args.objects.selections.indexOf(n)
            //delete this.args.objects.selections[nidx]
            this.args.objects.selections &#x3D; this.args.objects.selections.filter(e &#x3D;&gt; e !&#x3D;&#x3D; n)
            this.removePath(&#x27;SelectionPath&#x27;, n)
        } else {
            this.args.objects.selections.push(n)
            this.addPath(&#x27;SelectionPath&#x27;, n)
        }
    }

    // es kann nur einen pro id geben, gibt es bereits einen wird dieser entfernt 
    // (praktisch fÃ¼r hover)
    protected setPathHead(path: Path, n: N) {
        const pt &#x3D; path ? path.type : &#x27;HoverPath&#x27;

        const oldPathId &#x3D; this.btnPathId(pt, n)
        const oldPath &#x3D; this.args.objects.pathes.find(e &#x3D;&gt; e.id &#x3D;&#x3D;&#x3D; oldPathId)

        if (oldPath)
            this.removePath(pt, oldPath.head)
        if (n)
            this.addPath(pt, n)
    }

    protected addPath(pathType: string, n: N, color ? ) {
        // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 568 ~ Hypertree ~ addPath ~ pathType&quot;, pathType)
        // // console.log(&quot;ðŸš€ ~ file: hypertree.ts ~ line 505 ~ addPath ~ color&quot;, color)
        const plidx &#x3D; stringhash(n.precalc.label)
        // const color &#x3D; ({
        //     &#x27;HoverPath&#x27;: &#x27;none&#x27;, 
        //     &#x27;Query&#x27;: googlePalette(15) 
        // })[pathType] || googlePalette(plidx) || googlePalette(1) 
        color &#x3D; color || &#x27;#8ba9dd&#x27;;

        const newpath: Path &#x3D; {
            type: pathType,
            id: this.btnPathId(pathType, n),
            icon: ({
                &#x27;HoverPath&#x27;: &#x27;mouse&#x27;
            })[pathType] || &#x27;place&#x27;,
            head: n,
            headName: n.precalc.label,
            ancestors: n.ancestors(),
            color: color,
        }

        // model mod
        this.args.objects.pathes.push(newpath)
        n.pathes.headof &#x3D; newpath
        if (pathType !&#x3D;&#x3D; &#x27;HoverPath&#x27;)
            n.pathes.finalcolor &#x3D; n.pathes.labelcolor &#x3D; newpath.color

        // model mod: node context        
        n.ancestors().forEach((pn: N) &#x3D;&gt; {
            pn.pathes.partof &#x3D; this.addIfNotInSafe(
                pn.pathes.partof,
                newpath,
                pathType &#x3D;&#x3D;&#x3D; &#x27;HoverPath&#x27; ? &#x27;push&#x27; : &#x27;unshift&#x27;
            )

            if (pathType !&#x3D;&#x3D; &#x27;HoverPath&#x27;)
                pn.pathes.finalcolor &#x3D; newpath.color

            pn.pathes[&#x60;isPartOfAny${pathType}&#x60;] &#x3D; true
        })
        return newpath
    }

    protected removePath(pathType: string, n: N) {
        try {
            const pathId &#x3D; this.btnPathId(pathType, n)
            if (this.args.objects.pathes) {
                // model mod
                this.args.objects.pathes &#x3D; this.args.objects.pathes.filter(e &#x3D;&gt; e.id !&#x3D;&#x3D; pathId)
                n.pathes.headof &#x3D; undefined
                if (pathType !&#x3D;&#x3D; &#x27;HoverPath&#x27;)
                    n.pathes.labelcolor &#x3D; undefined
                // model mod: node context        
                n.ancestors().forEach((pn: N) &#x3D;&gt; {
                    if (pn.pathes.partof) {
                        pn.pathes.partof &#x3D; pn.pathes.partof.filter(e &#x3D;&gt; e.id !&#x3D;&#x3D; pathId)
                        pn.pathes.finalcolor &#x3D; pn.pathes.partof.length &gt; 0 ?
                            pn.pathes.partof[0].color :
                            undefined

                        if (pn.pathes.finalcolor &#x3D;&#x3D;&#x3D; &#x27;none&#x27;)
                            pn.pathes.finalcolor &#x3D; undefined

                        const nodeFlagName &#x3D; &#x60;isPartOfAny${pathType}&#x60;
                        pn.pathes[nodeFlagName] &#x3D; pn.pathes.partof.some(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; pathType)
                    }
                })
            }
        } catch (e) {
            console.warn(&#x27;no path to remove&#x27;, e);
        }
    }

    //########################################################################################################
    //##
    //## Animation frames ans animations
    //##
    //########################################################################################################

    public drawDetailFrame() {
        this.update.data()
    }

    public animateUp(ok, err): void {
        const newÎ» &#x3D; this.args.geometry.transformation.state.Î»
        this.args.geometry.transformation.state.Î» &#x3D; .001
        this.animateToÎ»(ok, err, newÎ»)
    }

    public animateToÎ»(ok, err, newÎ», duration &#x3D; 300): void {
        const initÎ» &#x3D; this.args.geometry.transformation.state.Î»
        const way &#x3D; initÎ» - newÎ»
        new Animation({
            name: &#x27;animateToÎ»&#x27;,
            hypertree: this,
            duration: duration,
            resolve: ok,
            reject: err,
            frame: (progress01) &#x3D;&gt; {
                const waydone01 &#x3D; 1 - sigmoid(progress01)
                // console.assert(waydone01 &gt;&#x3D; 0 &amp;&amp; waydone01 &lt;&#x3D; 1)
                const waydone &#x3D; way * waydone01
                const Î» &#x3D; newÎ» + waydone
                this.args.geometry.transformation.state.Î» &#x3D; Î»
                this.updateLayoutPath_(this.args.geometry.transformation.cache.centerNode)
                this.update.transformation()
            }
        })
    }

    public animateTo(resolve, reject, newP: C, newÎ»: number, duration &#x3D; 750): void {
        const initTS &#x3D; clone(this.args.geometry.transformation.state)
        const way &#x3D; CsubC(initTS.P, newP)
        new Animation({
            name: &#x27;animateTo&#x27;,
            resolve: resolve,
            reject: reject,
            hypertree: this,
            duration: duration,
            frame: (progress01) &#x3D;&gt; {
                const waydone01 &#x3D; 1 - sigmoid(progress01)
                // console.assert(waydone01 &gt;&#x3D; 0 &amp;&amp; waydone01 &lt;&#x3D; 1)
                const waydone &#x3D; CmulR(way, waydone01)
                const animP &#x3D; CaddC(newP, waydone)
                CassignC(this.args.geometry.transformation.state.P, animP)
                this.update.transformation()
            }
        })
    }

    public isAnimationRunning(): boolean {
        const view &#x3D; this.unitdisk &amp;&amp; this.unitdisk.isDraging
        const nav &#x3D; this.unitdisk &amp;&amp; this.unitdisk.isDraging
        const lowdetail &#x3D; this.transition ? this.transition.lowdetail : false
        return view || nav || lowdetail
    }
}

/*
class TransitionModel {
    public hypertree : Hypertree
    public type : &#x27;animation&#x27; | &#x27;interaction&#x27; | &#x27;script&#x27;
    public frames : Frame[] &#x3D; []
    public lowdetail &#x3D; true
    public currentframe : Frame    
    public beginTime
    public endTime
}*/

export class Transition {
    public hypertree: Hypertree
    public type: &#x27;animation&#x27; | &#x27;interaction&#x27; | &#x27;script&#x27;
    public frames: Frame[] &#x3D; []
    public lowdetail &#x3D; true
    public currentframe: Frame
    public beginTime
    public endTime

    constructor(hypertree) {
        this.hypertree &#x3D; hypertree
    }

    protected begin() {
        this.beginTime &#x3D; performance.now()

    }

    protected end() {
        this.currentframe &#x3D; undefined
        this.hypertree.transition &#x3D; undefined
        // console.groupEnd()
    }
}

export class Frame {
    nr: number
    created: number
    begin: number
    end: number
    calculations: number
    uiupdate: number
    cachestats: {
        n,
        //countof culled, labels, cells whatnot
    }
    constructor(nr: number) {
        this.nr &#x3D; nr
        this.created &#x3D; performance.now()
    }
}

class Animation extends Transition {
    resolve
    reject
    constructor(args) {
        super(args.hypertree)
        if (args.hypertree.transition) {
            // console.warn(&quot;Animaiion collision&quot;)
            return
        }

        // console.group(&#x27;Transition: &#x27; + args.name)
        args.hypertree.transition &#x3D; this
        this.hypertree.log.push(this.hypertree.transition)

        const frame &#x3D; () &#x3D;&gt; {
            //console.group(&quot;Frame&quot;)            

            this.currentframe &#x3D; new Frame(0)
            this.frames.push(this.currentframe)

            const now &#x3D; performance.now()
            if (!this.beginTime) {
                this.begin()
                this.endTime &#x3D; now + args.duration
            }

            const done &#x3D; now - this.beginTime
            const p01 &#x3D; done / args.duration

            if (now &gt; this.endTime) {
                args.frame(1)
                this.end()
                // console.log(&#x27;resolve by: time (maybe jump at end)&#x27;)
                args.resolve()
            } else {
                args.frame(p01)
                requestAnimationFrame(() &#x3D;&gt; frame())
            }

            this.currentframe &#x3D; undefined
            //console.groupEnd()
            // console.debug(&#x27;frame end&#x27;, )
        }

        requestAnimationFrame(() &#x3D;&gt; frame())
    }
}</code></pre>
    </div>
</div>









                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'Transition.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
